<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.medcn.user.dao.CspPackageOrderDAO" >

    <select id="totalMoney" resultType="java.util.Map">
        SELECT currency_type,SUM(should_pay) AS money FROM t_csp_package_order GROUP BY currency_type
    </select>

    <select id="orderCapitalStati" resultType="java.util.Map">
        SELECT
        <if test="grain != 0">
            DATE(create_time) as createTime,
        </if>
        <if test="grain != 2">
            MONTH(create_time) as createTime,
        </if>
        <if test="grain != 4">
            YEAR(create_time) as createTime,
        </if>
        SUM(should_pay) AS money
        FROM t_csp_package_order where 1=1
        <if test="abroad != null">
            and currency_type=#{abroad}
        </if>
        <if test="startTime != null and endTime != null">
            AND create_time BETWEEN #{startTime} AND #{endTime}
        </if>
        <if test="grain != 0">
            GROUP BY DATE(create_time)
        </if>
        <if test="grain != 2">
            GROUP BY MONTH(create_time)
        </if>
        <if test="grain != 4">
            GROUP BY YEAR(create_time)
        </if>
    </select>

    <select id="getCapitalByDay" resultType="cn.medcn.user.dto.CspOrderPlatFromDTO">
        SELECT
        <if test="grain != 0">
            DATE(create_time) as create_time,
        </if>
        <if test="grain != 2">
            MONTH(create_time) as create_time,
        </if>
        <if test="grain != 4">
            YEAR(create_time) as create_time,
        </if>
        SUM(CASE WHEN plat_form='alipay_wap' or plat_form = 'alipay_pc_direct' THEN should_pay END) AS alipay_wap,
        SUM(CASE WHEN plat_form='wx_pub_qr' THEN should_pay END) AS wx_pub_qr,
        SUM(CASE WHEN plat_form='upacp_wap' or plat_form = 'upacp_pc' THEN should_pay END) AS upacp_wap,
        SUM(CASE WHEN plat_form='paypal' THEN should_pay END) AS paypal,
        SUM(should_pay) AS money
        FROM t_csp_package_order where 1=1
        <if test="abroad != null">
            currency_type=#{abroad}
        </if>
        <if test="startTime != null and endTime != null">
            AND create_time BETWEEN #{startTime} AND #{endTime}
        </if>
        <if test="grain != 0">
            GROUP BY DATE(create_time)
        </if>
        <if test="grain != 2">
            GROUP BY MONTH(create_time)
        </if>
        <if test="grain != 4">
            GROUP BY YEAR(create_time)
        </if>
    </select>

    <select id="getTotalCapital" resultType="cn.medcn.user.dto.CspOrderPlatFromDTO">
        SELECT sum(should_pay) as totalMoney
        FROM t_csp_package_order where 1=1
        <if test="abroad != null">
            AND currency_type=#{abroad}
        </if>
        <if test="startTime != null and endTime != null">
            AND create_time BETWEEN DATE(#{startTime}) AND DATE(#{endTime})
        </if>
    </select>

    <select id="selectAbroadAndHomeMoney" resultType="cn.medcn.user.model.CspPackageOrder">
      SELECT currency_type as currencyType,sum(pay_money) AS totalMoney FROM `t_csp_package_order` GROUP BY currency_type
    </select>



    <select id="findOrderListByCurrencyType" resultType="cn.medcn.user.dto.CspPackageOrderDTO">
        SELECT o.trade_id as id,u.nick_name,o.plat_form,o.create_time,o.pay_money as money,o.state as status,o.remark,o.package_type,
        o.package_id,u.abroad,o.num
        FROM t_csp_package_order o LEFT JOIN t_csp_user_info u ON o.user_id=u.id
        WHERE
        <if test="type != null">
            o.currency_type=#{type}
        </if>
        <if test="startTime != null and endTime != null">
            AND create_time BETWEEN #{startTime} AND #{endTime}
        </if>
        <if test="tradeId != null">
            o.trade_id=#{tradeId}
        </if>
        ORDER BY create_time DESC
    </select>

    <select id="findOrderSuccessSum" resultType="Integer">
        SELECT sum(pay_money) FROM t_csp_package_order WHERE
        currency_type = #{type}
        <if test="startTime != null and endTime != null and startTime !='' and endTime != ''">
            AND create_time BETWEEN #{startTime} AND #{endTime}
        </if>
        GROUP BY currency_type
    </select>

    <select id="selectNewMoney" resultType="Double">
        SELECT IFNULL(sum(pay_money),0) FROM t_csp_package_order where create_time = curdate()-INTERVAL 1 day AND  currency_type = #{currencyType} AND state = 1
    </select>
</mapper>