<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.medcn.user.dao.CspUserInfoDAO" >

    <select id="findBindUserByUniqueId" resultType="cn.medcn.user.model.CspUserInfo">
      SELECT u.*,f.flux FROM t_csp_user_info u
      LEFT JOIN t_csp_bind_info b ON b.user_id = u.id
      LEFT JOIN t_csp_user_flux f ON f.user_id = u.id
      WHERE b.unique_id = #{uniqueId}
    </select>

    <select id="findByLoginName" resultType="cn.medcn.user.model.CspUserInfo">
        SELECT u.*,f.flux FROM t_csp_user_info u
        LEFT JOIN t_csp_user_flux f ON u.id = f.user_id
        WHERE u.mobile = #{username} OR u.email = #{username}
    </select>

    <select id="findCspUserById" resultType="cn.medcn.user.model.CspUserInfo">
        SELECT u.*,f.flux FROM t_csp_user_info u
        LEFT JOIN t_csp_user_flux f ON u.id = f.user_id
        WHERE u.id = #{userId}
    </select>

    <select id="findCSPUserInfo" resultType="cn.medcn.user.dto.CspUserInfoDTO">
        SELECT tu.avatar,tu.email,tu.nick_name,tu.mobile,tu.info,count(tc.id) AS pptCount,
        (SELECT count(ts.id)  FROM t_csp_share ts WHERE ts.user_id = #{userId}) AS shareCount
        FROM t_csp_user_info tu
         LEFT JOIN t_audio_course tc ON tu.id = tc.csp_user_id
         WHERE tu.id = #{userId} GROUP BY tc.csp_user_id

    </select>


    <select id="findVideoLiveRecord" resultType="cn.medcn.user.dto.VideoLiveRecordDTO">
        SELECT tu.id,tu.expense,tu.video_down_url,tu.expire_time,t.meet_name FROM  t_csp_user_flux_usage tu
        LEFT JOIN t_meet t ON t.id = tu.meeting_id
        WHERE tu.user_id = #{userId}
    </select>

    <select id="findCspUserList" resultType="cn.medcn.user.model.CspUserInfo">
        SELECT * FROM t_csp_user_info WHERE 1=1
        <if test="userName != null">
            AND user_name = #{userName}
        </if>
    </select>


</mapper>